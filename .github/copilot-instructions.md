# Copilot Instructions for TTRPG Convert CLI

## Repository Summary

This is a Java 17+ command-line tool that converts TTRPG (tabletop role-playing game) data from 5eTools and Pf2eTools JSON formats into crosslinked, tagged markdown files optimized for [Obsidian.md](https://obsidian.md). The project supports both D&D 5th Edition and Pathfinder 2nd Edition content conversion.

## High-Level Repository Information

- **Project Type**: Java CLI application built with Quarkus framework
- **Languages**: Java 17+ (tested with Java 17 and 21, avoid Java 24)
- **Build System**: Maven with wrapper (`./mvnw`)
- **Framework**: Quarkus 3.25.4 (supersonic subatomic Java framework)
- **CLI Framework**: Picocli for command-line interface
- **Templating**: Qute templating engine for markdown generation
- **Package Type**: Uber-jar (single executable JAR with all dependencies)
- **Repository Size**: ~200 Java files, comprehensive test suite
- **Entry Point**: `src/main/java/dev/ebullient/convert/RpgDataConvertCli.java`

## Build and Validation Instructions

### Prerequisites
- **Java 17** (required) - Java 21 also works, avoid Java 24 due to known picocli issues
- No other external dependencies required (Maven wrapper handles everything)

### Essential Build Commands

Always run commands from the repository root directory.

**Basic Development Workflow:**
```bash
# 1. Clean build and test (takes ~2 minutes)
./mvnw clean test -B

# 2. Format code and sort imports (always run before committing)
./mvnw process-sources

# 3. Build the executable JAR
./mvnw package -DskipTests

# 4. Generate CSS files from SCSS
./mvnw sass-cli:run
```

**Key Build Validation Commands:**
- `./mvnw clean test -B` - Full test suite (~2 min), must pass before commits
- `./mvnw compile -B` - Quick compilation check (~30 sec)
- `./mvnw package` - Creates `target/ttrpg-convert-cli-*-runner.jar` (~12 sec)
- `./mvnw process-sources` - **Always run before commits** - formats code and sorts imports
- `./mvnw javadoc:javadoc` - Generates template documentation in `docs/templates/`

**CSS Building:**
- `./mvnw sass-cli:run` - Build CSS from SCSS sources (some deprecation warnings are expected)
- `./mvnw sass-cli:watch` - Watch mode for CSS development
- Generated CSS files appear in `examples/css-snippets/`

**Testing and Integration:**
- `./mvnw test` - Unit tests only
- `./mvnw test -DskipITs=false` - Include integration tests (requires native binary)
- Integration tests (IT) are run against the final JAR artifact

### Build Outputs and Validation
- Main artifact: `target/ttrpg-convert-cli-*-runner.jar` (uber-jar, ~25MB)
- Test: `java -jar target/ttrpg-convert-cli-*-runner.jar --help`
- Generated CSS: `examples/css-snippets/*.css`
- Template docs: `docs/templates/` (generated by custom Javadoc doclet)

### Environment Setup Requirements
- Create `sources/` directory for test data (optional, but needed for comprehensive testing)
- No additional environment setup required for basic development

### Common Build Issues and Workarounds
- **Java Version**: Must use Java 17-21. Java 24 has known picocli compatibility issues
- **SASS Warnings**: CSS build shows deprecation warnings - these are expected and non-blocking
- **Test Dependencies**: Some tests expect `sources/` directory structure but skip gracefully if missing
- **Format Enforcement**: Code formatting is strictly enforced - always run `./mvnw process-sources` before commits

## Project Layout and Architecture

### Core Architecture
```
src/main/java/dev/ebullient/convert/
├── RpgDataConvertCli.java          # Main CLI entry point
├── config/                         # Configuration handling classes
├── io/                            # Input/output operations
│   ├── MarkdownWriter.java        # Writes markdown files using templates
│   ├── MarkdownDoclet.java        # Custom Javadoc doclet for template docs
│   └── Tui.java                   # Text user interface (console output)
├── qute/                          # Base template model classes
└── tools/                         # Game system-specific conversion logic
    ├── dnd5e/                     # D&D 5th Edition specific converters
    └── pf2e/                      # Pathfinder 2nd Edition specific converters
```

### Key Configuration Files
- `pom.xml` - Maven project configuration
- `.editorconfig` - Code formatting rules
- `src/ide-config/eclipse-format.xml` - Code formatter configuration
- `.markdownlint.yaml` - Markdown linting rules
- `.gitignore` - Excludes build artifacts and test data

### Template System
- Templates use Qute engine for markdown generation
- Template model classes in `src/main/java/*/qute/` packages
- Generated documentation in `docs/templates/` (via custom Javadoc doclet)
- Example templates in `examples/templates/`

### Testing Structure
- Unit tests: `src/test/java/dev/ebullient/convert/`
- Integration tests: `*IT.java` files (test against final JAR)
- Test resources: `src/test/resources/`
- Test outputs: `target/test-5e/` and `target/test-pf2/`

## GitHub Actions CI/CD Pipeline

### Pull Request Validation (`.github/workflows/pr-tests.yml`)
- **Environment**: Ubuntu latest, Java 17 (Temurin distribution)
- **Commands Executed**:
  1. `mvn clean test -B` - Full test suite
  2. `mvn compile -B` - Compilation verification
- **Additional Checks**: Conventional commit format validation
- **Build Cache**: Maven dependencies cached for performance

### Validation Steps to Replicate CI
```bash
# Replicate PR build locally
./mvnw clean test -B
./mvnw compile -B
```

## Key Development Facts

### Code Style and Formatting
- **Strict formatting**: Code formatting and import sorting are enforced
- **Always run**: `./mvnw process-sources` before committing
- **Editor support**: Uses Eclipse formatter config in `src/ide-config/`
- **Import organization**: Specific import grouping rules enforced

### CLI Usage Patterns
- Supports both JSON and YAML configuration files
- Default config search: `config.json` then `config.yaml` in current directory
- Input: JSON files from 5eTools/Pf2eTools or homebrew
- Output: Structured markdown files for Obsidian.md

### Dependencies and External Data
- **No external data required** for basic development and testing
- **Optional test data**: `sources/` directory can contain 5eTools/Pf2eTools data for comprehensive testing
- **Self-contained**: All dependencies managed through Maven

### Template Development
- Templates are Qute-based (.qute extensions)
- Model classes provide data to templates
- Documentation auto-generated from Javadoc annotations
- Custom template development supported through examples

### Performance Considerations
- Test suite takes ~2 minutes (acceptable for CI)
- Build packaging takes ~12 seconds
- CSS generation has deprecation warnings (non-blocking)
- Uber-jar approach creates single executable (~25MB)

## File Organization Priority

### Root Directory Contents
```
├── .editorconfig              # Code formatting rules
├── .gitignore                # Build artifacts exclusion
├── .markdownlint.yaml        # Markdown linting configuration
├── CONTRIBUTING.md           # Developer guidelines and setup
├── README.md                 # User documentation and setup
├── mvnw, mvnw.cmd           # Maven wrapper (cross-platform)
├── pom.xml                  # Maven project configuration
├── .github/                 # GitHub Actions and project metadata
├── docs/                    # Documentation (includes generated content)
├── examples/                # Sample configurations and templates
└── src/                     # Source code and tests
```

### Important Subdirectories
- `src/main/java/dev/ebullient/convert/` - Core application code
- `src/test/java/` - Test suites and validation
- `docs/` - Documentation including auto-generated template docs
- `examples/` - Configuration examples, templates, CSS snippets
- `.github/workflows/` - CI/CD pipeline definitions

## Trust These Instructions

These instructions have been validated by running all build commands and testing the development workflow. When working with this repository:

1. **Always start with**: `./mvnw clean test -B` to validate your environment
2. **Before committing**: `./mvnw process-sources` for formatting
3. **For builds**: `./mvnw package` creates the executable JAR
4. **For CSS changes**: `./mvnw sass-cli:run` builds stylesheets

Only perform additional searching if these instructions prove incomplete or if you encounter errors not covered here. The build process is well-established and these commands represent the standard workflow used by the development team.